<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
<mapper namespace="edu.eci.cvds.sampleprj.dao.mybatis.mappers.NovedadMapper">


	<resultMap type='Novedad' id='NovedadResult'>
		<id property='id' column='id'/>
		<result property='fecha' column='fecha'/>
		<result property='titulo' column='titulo'/>  
		<result property="detalle" column="detalle"/>
		<association property="elemento" javaType='Elemento' resultMap="edu.eci.cvds.sampleprj.dao.mybatis.mappers.ElementoMapper.ElementoResult"></association>
		<association property="equipo" javaType='Equipo' resultMap="edu.eci.cvds.sampleprj.dao.mybatis.mappers.EquipoMapper.EquipoResult"></association> 

	</resultMap>
	
	<insert parameterType="map" id="registrarNovedad" >
		
		INSERT INTO novedad values((SELECT MAX(id) +1 FROM novedad),NOW(),#{idn.titulo},1,#{idn.detalle},#{idn.equipo.id},#{idn.elemento.id})
		
	</insert>
	
	<select parameterType="map" id="consultarNovedadporElemento" resultMap="NovedadResult">
		
		
		
		SELECT
    
			n.id,
			n.fecha,
			e.nombre,
			n.titulo,
			n.detalle

		
		FROM novedad AS n
		left join elemento as e on n.idelemento = e.id 
		
		WHERE n.idelemento=#{numero}
		
		ORDER BY n.id DESC
		
		
	</select>
	
	<select parameterType="map" id="consultarNovedadporEquipo" resultMap="NovedadResult">
		
		
		
		SELECT
    
			id,
			fecha,
			titulo,
			detalle
		

		
		FROM novedad
		
		WHERE idequipo=#{numero}
		
		ORDER BY id DESC
		
		
	</select>
	
	<select parameterType="map" id="consultarNovedades" resultMap="NovedadResult">
		SELECT
			
			n.id,
			n.fecha,
			e.nombre,
			n.titulo,
			n.detalle		
		FROM novedad AS n
		left join elemento as e on n.idelemento = e.id 
		
		ORDER BY id DESC
		
		
	</select>
	

	
	
</mapper>